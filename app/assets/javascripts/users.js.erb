promeni.factory('User', ['$resource', function($resource) {
  return $resource('/api/v1/users/:id', null, {
    'query': { method:'GET', isArray: false },
  });
}]);

promeni.controller("UserShowController", ["$scope", "$routeParams", "$http", "User", function($scope, $routeParams, $http, User) {

  $scope.proposals = [];
  $scope.comments = [];

  User.get({ id: $routeParams.id }).$promise.then(function(user) {
    $scope.user = user;
  });

  $http.get("/api/v1/proposals?user_id=" + $routeParams.id).success(function(data) {
    $scope.proposals = data.proposals;
    $scope.proposalsCount = data.proposals_count;
  });

  $http.get("/api/v1/comments?user_id=" + $routeParams.id).success(function(data) {
    $scope.comments = data.comments;
    $scope.commentsCount = data.comments_count;
  });

}]);

promeni.controller("UserIndexController", ["$scope", "$routeParams", "User", function($scope, $routeParams, User) {

  $scope.rank = $routeParams.rank;

  User.query({ rank: $routeParams.rank }).$promise.then(function(data) {
    $scope.users = data.users;
    $scope.usersCount = data.users_count;
  });

}]);

promeni.directive("userButton", [function() {
  return {
    restrict: "E",
    templateUrl: "<%= asset_path('user_button.html') %>",
    scope: {
      user: "="
    }
  }
}]);

