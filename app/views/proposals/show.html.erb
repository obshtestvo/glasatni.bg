<% voted_on = Voting.where(user: current_user).pluck(:votable_id, :value) %>

<div class="row">
  <div class="col-md-1">
    <br />
    <br />
    <center>
    <%= parse_buttons @proposal, voted_on, :proposal %>
    <p class="text-muted"><%= @proposal.rating %></p>
    </center>
  </div>
  <div class="col-md-11">
    <h1><%= @proposal.title %> </h1>
    <%= link_to @proposal.theme.name, theme_path(@proposal.theme), class: "btn btn-success btn-sm pull-left" %>
    <div class="btn-group pull-right">
      <%= link_to edit_proposal_path(@proposal), class: "btn btn-default btn-sm #{'disabled' if !user_signed_in?}" do %>
        <i class="fa fa-pencil"></i>
      <% end %>
      <%= link_to @proposal, method: :delete, data: { confirm: 'Сигурен ли си, че искаш да изтриеш това предложение?' }, class: "btn btn-default btn-sm btn-danger #{'disabled' if !user_signed_in?}" do %>
        <i class="fa fa-times"></i>
      <% end %>
    </div>
  </div>
</div>

<br />

<%= simple_format @proposal.content %>

<p class="text-right">
<%= link_to user_path(@proposal.user), class: "btn btn-default btn-sm" do %>
  <%= @proposal.user.name %>
<% end %>
</p>

<hr />

<h3>Коментари</h3>

<% if user_signed_in? %>

  <div id="warning" class="bs-callout bs-callout-danger" style="display:none">
    <h4>Само да ти кажем някои неща...</h4>
    Опитай се да бъдеш максимално изчерпателен(на). Всякакви расистки, хомофобски, сексистки, шовинистки коментари ще бъдат изтривани, както и коментари приканващи към насилие над хора или животни.
    Коментарите трябва да са с минимална дължина от 100 символа.
  </div>

  <textarea id="comment-box" name="" rows="8" cols="40" class="form-control" placeholder="Напиши своя коментар тук."></textarea>
  <br />
  <div class="row">
    <div class="col-md-1">
      <%= button_tag "Коментирай", class: "btn btn-success", id: "send-button", disabled: "disabled" %>
    </div>
    <div class="col-md-4">
      <p id="symbolsBox" class="text-muted text-right">Остават ти 100 символа.</p>
    </div>
  </div>

<% else %>

  <div id="not-registered" class="bs-callout bs-callout-danger">
    <h4>Само регистрирани потребители могат да оставят коментари.</h4>
    Регистрирането ти позволява също да гласуваш. Можеш да се регистрираш <%= link_to "от тук", new_registration_path(:user) %>.
  </div>

<% end %>

<hr />

<div id="comments-list">
  <% @proposal.comments.order(:created_at).each do |c| %>

    <% @comment = c %>
    <%= render "comments/show", voted_on: voted_on, with_hr: c != @proposal.comments.last %>

  <% end.empty? and begin %>
    <div id="no-comments" class="bs-callout bs-callout-info">
      <h4>Все още няма коментари!</h4>
      Бързо напиши един, за да изпревариш останалите!
    </div>
  <% end %>
</div>

<div class="modal fade" id="whoops-box">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title">Опа!</h4>
      </div>
      <div class="modal-body">
        <p>Изглежда в момента гласуването на работи! Моля да ни извините!</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal">От мен да мине.</button>
      </div>
    </div>
  </div>
</div>
